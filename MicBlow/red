#include<stdio.h>
#include<stdlib.h>
#include<string.h>
#include<math.h>

#include"wpdef.h"
#include"windpeak.h"
#include"wavhead.h"
#include"filter.h"

/**
**处理方法    
**/
void recordBufferHandler(short int* inData,UInt32 length){
    //length的长度是固定的 8192

    dataout = calloc(5000,2);

    //打印inData前1000个数字
    for (int i=0; i<1000; i++) {
        printf("%d ",*(inData+i));
    }

    filter(inData,length/2,dataout,b_filter,N_fil);

    //打印过滤后的dataout前1000个数字
    for (int i=0; i<1000; i++) {
        printf("%d ",*(dataout+i));
    }

    double d = energy(dataout, 1000);//这里只拿了前1000位计算能量

    NSLog(@"强度：%f",d);
}



下面是我截取的某一时间点的打印信息



---------------------------------------inData:-----------------------------------------

1116 1130 1130 1187 1172 1144 1144 1074 1074 1074 1017 1031 1045 1003 1031 1031 1003 1031 975 932 961 890 791 805 791 819 904 918 918 946 932 890 848 763 749 692 678 636 579 565 565 565 565 593 636 650 607 523 424 339 226 85 57 14 -57 -57 -14 -14 -85 -127 -184 -240 -254 -339 -424 -466 -509 -494 -509 -466 -396 -339 -283 -226 -226 -311 -424 -494 -523 -593 -678 -720 -735 -735 -706 -678 -650 -593 -551 -565 -551 -537 -565 -537 -607 -678 -664 -664 -678 -692 -650 -664 -664 -622 -622 -565 -579 -636 -692 -763 -791 -833 -904 -918 -890 -819 -749 -636 -636 -650 -636 -706 -791 -904 -946 -961 -918 -862 -819 -706 -565 -466 -410 -381 -367 -396 -494 -537 -509 -551 -607 -579 -551 -537 -509 -466 -396 -339 -339 -311 -297 -353 -339 -381 -396 -339 -311 -240 -155 -113 -141 -184 -170 -212 -240 -283 -339 -367 -353 -339 -339 -325 -268 -254 -212 -170 -127 -99 -99 -57 -85 -99 -113 -99 -99 -113 -85 -127 -85 -85 -42 57 14 14 -42 -42 -99 -212 -198 -184 -170 -127 -85 -85 -28 -14 -14 28 42 42 0 -57 -127 -155 -155 -99 -71 14 113 155 226 254 283 198 141 99 71 57 28 85 99 141 212 268 297 254 212 184 184 127 85 155 184 212 226 226 268 268 283 254 198 212 212 127 57 57 71 99 113 155 155 155 240 226 212 212 212 240 226 311 325 353 339 268 254 212 226 240 268 283 297 268 240 254 198 155 184 212 212 268 311 297 353 410 438 466 424 367 283 240 198 170 212 254 311 367 424 438 424 396 396 381 381 367 283 254 198 226 254 283 268 268 367 396 353 311 381 339 339 410 367 466 509 509 509 466 396 268 141 127 127 127 170 226 283 325 367 396 353 283 268 254 254 297 268 283 254 212 212 141 113 99 42 71 57 14 71 57 85 170 170 85 14 -14 -99 -127 -141 -141 -99 14 57 85 184 155 212 184 170 127 0 -71 -155 -198 -212 -155 -141 -71 42 71 99 71 28 57 0 14 0 -71 -71 -141 -155 -155 -155 -155 -170 -141 -155 -127 -127 -141 -57 -28 -155 -254 -170 -113 -141 -170 -424 -565 -367 -339 -339 -509 -692 -692 -650 -424 -537 -551 -622 -678 -396 -480 -494 -367 -339 -268 -297 -509 -494 -551 -565 -494 -509 -424 -438 -325 -381 -410 -424 -579 -579 -607 -565 -622 -692 -607 -551 -551 -763 -735 -636 -777 -692 -664 -523 -452 -424 -593 -805 -452 -509 -325 -254 -494 -155 71 28 -212 -325 -297 -367 -367 -353 -339 -339 -297 -42 0 -28 -226 -381 -226 -325 -311 -396 -381 -311 -85 42 42 141 0 -57 -198 -198 -184 -311 -410 -325 -14 141 170 42 0 99 198 127 85 -71 -42 28 14 -42 -113 -28 -184 -85 -57 -99 -113 -184 -85 -71 71 71 71 99 14 127 113 0 -184 -170 -99 -99 -28 -28 85 57 155 127 99 127 170 268 226 325 396 353 226 170 127 -14 -155 -226 -127 -113 -155 -99 -184 -99 -42 -71 14 -28 -85 -85 -57 -28 71 170 141 170 226 226 212 113 28 14 85 42 71 71 99 184 268 339 311 339 396 410 466 438 339 438 480 438 494 480 523 551 523 480 396 381 311 283 297 339 438 494 565 565 565 537 494 480 410 353 381 367 367 367 367 480 509 537 523 494 494 466 381 339 466 509 480 509 537 565 551 494 424 339 325 198 155 325 325 381 509 537 607 720 777 763 749 706 607 593 593 551 565 494 466 509 565 579 579 537 466 353 283 283 71 28 -42 -113 -71 -155 -113 -99 -127 -127 -113 -141 -184 -127 -226 -268 -283 -367 -452 -509 -579 -593 -551 -523 -466 -480 -480 -367 -353 -367 -381 -381 -339 -325 -283 -268 -184 -85 -99 -42 -28 28 71 28 14 -28 0 28 127 99 28 113 170 226 226 212 127 155 57 -57 0 -85 0 85 127 155 170 198 113 127 28 -57 -71 -127 -99 -99 -57 -14 28 85 113 170 184 85 99 141 113 99 42 85 42 42 57 -42 28 -71 -141 -99 -155 -85 -42 -42 -57 28 57 -14 28 14 -14 57 -14 -71 -42 -99 -113 -127 -127 -184 -198 -127 -212 -99 -14 -42 141 170 198 297 198 113 127 0 -14 -57 -198 -99 -113 -42 71 127 240 170 170 99 42 -57 -184 -212 -297 -283 -283 -226 -268 -212 -141 -198 -170 -184 -155 -254 -283 -367 -438 -353 -381 -283 -226 -226 -170 -141 -212 -283 -325 -381 -339 -367 -311 -268 -367 -254 -268 -325 -325 -396 -367 -410 -452 -480 -523 -537 -593 -622 -650 -664 -650 -537 -480 -438 -339 -226 -155 -184 -127 -170 -240 -226 -339 -381 -367 -226 -155 -85 28 0 71 28 28 -42 -71 -141 -311 -311 -367 -353 -325 -297 -297 -212 -127 -127 -141 -170 -226 -268 -212 -240 -283 -240 -170 -57 42 57 42 28 42 -42 -113 -155 -212 -170 -170 -85 -57 28 85 57 99 28 -42 -28 -57 -71 -71 -85 -85 -28 -42 0 85 71 184 268 311 367 410 424 410 367 297 297 297 297 297 311 353 424 494 565 636 720 706 692 579 452 325 198 113 71 99 127 198 254 297 367 367 325 184 




---------------------------------------dataout:-----------------------------------------

548 582 607 634 662 686 714 735 764 786 811 831 852 881 897 918 932 950 971 981 999 1016 1032 1037 1054 1073 1081 1094 1101 1109 1123 1134 1148 1151 1160 1168 1175 1184 1185 1194 1201 1199 1204 1199 1203 1209 1207 1218 1219 1210 1215 1210 1200 1198 1191 1174 1175 1168 1160 1159 1146 1139 1126 1114 1105 1094 1083 1071 1056 1038 1025 1012 997 979 965 957 937 926 910 890 866 846 828 808 784 761 735 712 689 667 643 620 597 574 553 529 500 476 449 425 401 377 351 328 301 275 247 225 200 178 159 131 105 78 60 29 7 -14 -40 -63 -85 -108 -133 -152 -175 -199 -226 -255 -272 -292 -326 -348 -363 -375 -394 -410 -430 -449 -469 -486 -503 -518 -530 -541 -563 -570 -583 -594 -610 -617 -628 -630 -646 -652 -657 -675 -680 -688 -696 -697 -695 -695 -697 -696 -696 -695 -698 -694 -696 -694 -690 -691 -690 -683 -680 -672 -672 -669 -662 -658 -652 -648 -643 -640 -639 -630 -615 -611 -597 -592 -584 -568 -558 -549 -543 -533 -523 -515 -509 -498 -494 -481 -473 -469 -459 -448 -434 -425 -419 -408 -398 -384 -377 -367 -360 -358 -346 -332 -323 -310 -301 -290 -279 -264 -257 -254 -245 -239 -232 -222 -217 -210 -196 -187 -179 -171 -161 -152 -145 -137 -136 -138 -135 -132 -125 -117 -107 -96 -93 -85 -75 -71 -66 -59 -56 -55 -49 -49 -45 -43 -40 -32 -30 -24 -17 -16 -12 -14 -14 -14 -9 -2 1 7 16 23 32 38 43 49 53 58 63 70 74 78 84 87 92 91 97 102 107 113 119 123 127 136 142 144 150 151 156 157 161 165 168 172 181 185 190 195 196 203 206 213 222 219 219 219 220 225 229 234 243 242 247 246 247 249 250 250 250 254 260 264 271 283 293 292 291 286 284 284 284 285 287 288 296 301 306 308 308 311 309 310 314 313 312 314 316 317 317 317 323 321 326 324 325 321 322 322 321 319 324 317 314 313 308 306 310 307 301 302 296 297 293 294 290 283 279 269 271 271 270 265 260 256 254 250 244 241 236 228 217 204 203 201 198 197 192 185 181 177 170 162 157 147 145 142 136 131 124 119 116 114 112 107 102 96 93 89 80 73 63 55 51 51 50 43 29 18 12 2 -5 -9 -9 -4 -4 -11 -18 -28 -37 -49 -62 -76 -82 -93 -100 -103 -112 -121 -131 -141 -150 -164 -172 -181 -183 -192 -209 -214 -223 -235 -244 -257 -269 -272 -273 -298 -315 -326 -330 -327 -343 -354 -354 -352 -361 -370 -375 -381 -393 -402 -411 -420 -435 -439 -441 -439 -436 -443 -448 -451 -451 -459 -467 -476 -479 -474 -480 -485 -480 -475 -474 -476 -476 -477 -473 -480 -477 -476 -470 -469 -459 -458 -456 -450 -450 -453 -443 -432 -432 -432 -427 -415 -400 -393 -393 -388 -384 -370 -355 -347 -337 -338 -329 -316 -307 -297 -302 -286 -278 -275 -270 -263 -255 -247 -237 -223 -217 -212 -208 -200 -193 -191 -183 -177 -171 -157 -151 -145 -138 -128 -119 -117 -108 -104 -90 -86 -85 -73 -71 -65 -61 -62 -56 -46 -33 -43 -36 -35 -32 -21 -31 -37 -36 -30 -24 -23 -15 -10 -9 -7 -4 -2 -11 -13 -13 -5 0 -3 1 3 9 10 10 2 2 3 2 6 9 20 28 34 49 60 64 53 54 52 58 65 65 67 78 87 101 104 103 115 124 134 131 144 150 158 169 175 187 194 200 199 201 206 214 222 223 232 243 260 271 277 288 293 300 305 311 311 314 320 326 333 337 344 349 352 361 372 381 387 399 414 424 423 427 435 441 453 454 459 465 471 475 482 486 487 493 487 484 491 494 489 485 481 490 496 497 494 492 494 490 485 479 476 472 464 459 445 436 431 427 423 408 403 396 384 373 360 341 332 329 325 322 314 306 295 286 272 261 248 234 225 214 198 190 179 169 156 149 141 128 116 102 90 76 63 58 52 45 39 31 18 8 3 0 -5 -14 -19 -24 -27 -31 -30 -29 -34 -45 -52 -56 -60 -63 -67 -78 -86 -87 -91 -92 -87 -91 -89 -86 -89 -89 -90 -89 -87 -88 -88 -88 -85 -76 -75 -72 -65 -61 -53 -51 -51 -44 -45 -40 -37 -38 -35 -32 -28 -28 -25 -20 -18 -14 -11 -6 1 2 3 5 7 9 11 8 9 12 13 16 14 14 15 14 13 10 12 10 10 8 7 8 7 7 7 6 2 2 5 2 -1 -5 -5 -5 -3 -5 -1 1 0 4 3 0 -1 -3 -4 -10 -7 -14 -12 -14 -17 -18 -26 -28 -30 -35 -39 -50 -54 -59 -66 -69 -82 -92 -97 -103 -109 -124 -128 -134 -140 -141 -152 -156 -155 -160 -162 -170 -181 -189 -189 -197 -206 -207 -212 -221 -225 -232 -235 -239 -241 -246 -249 -252 -259 -259 -259 -258 -256 -261 -271 -270 -287 -287 -289 -298 -299 -301 -306 -306 -303 -304 -296 -295 -288 -290 -295 -300 -306 -303 -306 -301 -300 -296 -287 -281 -278 -274 -270 -268 -264 -261 -259 -254 -254 -245 -244 -238 -237 -223 -214 -211 -205 -201 -200 -195 -196 -195 -189 -180 -172 -167 -161 -157 -152 -152 -143 -142 -136 -130 -122 -104 -97 -86 -75 -67 -64 -58 -45 -40 -34 -23 -15 -12 -2



//强度输出值的变化，很容易触发   没看到过滤的效果

call input callback....
2011-09-15 17:02:12.870 MicBlow[1640:707] 强度：1.861588
call input callback....
2011-09-15 17:02:12.963 MicBlow[1640:707] 强度：4.942264
call input callback....
2011-09-15 17:02:13.055 MicBlow[1640:707] 强度：8.493008
call input callback....
2011-09-15 17:02:13.148 MicBlow[1640:707] 强度：7.371894
call input callback....
2011-09-15 17:02:13.240 MicBlow[1640:707] 强度：9.475414
call input callback....
2011-09-15 17:02:13.333 MicBlow[1640:707] 强度：220.591637
call input callback....
2011-09-15 17:02:13.427 MicBlow[1640:707] 强度：339.044143
call input callback....
2011-09-15 17:02:13.519 MicBlow[1640:707] 强度：32.722583
call input callback....
2011-09-15 17:02:13.613 MicBlow[1640:707] 强度：484.865867
call input callback....
2011-09-15 17:02:13.706 MicBlow[1640:707] 强度：190.373954
call input callback....
2011-09-15 17:02:13.798 MicBlow[1640:707] 强度：564.023013
call input callback....
2011-09-15 17:02:13.891 MicBlow[1640:707] 强度：16.401498
call input callback....
2011-09-15 17:02:13.983 MicBlow[1640:707] 强度：15.416468
call input callback....
2011-09-15 17:02:14.076 MicBlow[1640:707] 强度：13.467875
call input callback....
2011-09-15 17:02:14.169 MicBlow[1640:707] 强度：7957.282762
call input callback....
2011-09-15 17:02:14.263 MicBlow[1640:707] 强度：88.635995
call input callback....
2011-09-15 17:02:14.355 MicBlow[1640:707] 强度：72.495499
call input callback....
2011-09-15 17:02:14.448 MicBlow[1640:707] 强度：18673.124361
call input callback....
2011-09-15 17:02:14.541 MicBlow[1640:707] 强度：13447.094667
call input callback....
2011-09-15 17:02:14.633 MicBlow[1640:707] 强度：8283.894473
call input callback....
2011-09-15 17:02:14.726 MicBlow[1640:707] 强度：4804.595104
call input callback....
2011-09-15 17:02:14.820 MicBlow[1640:707] 强度：68.241426



我们是用“各种平台 读wav滤波求峰值存文件”这个下面的文件制作的。







上海地区iphone项目外包。
这样的需求：
1，我们有很多的课件，每个课件下面是一张一张的片子，就像ppt那样。我们服务器会定期的增加这样的课件，并更新总的课件列表。
2，客户端点击列表中的新课件，可以下载到iphone本地。进行浏览。   
3，片子并不是普通的图片，涉及到简单的动画，比如图片的淡入，淡出，放大，缩小，图片的移动这些动画，还有视频。
4，对于某个课件客户端可以自定义显示顺序，这样是为了让客户筛选自己感兴趣的片子。并保存可以筛选片子的数据，供以后浏览.














